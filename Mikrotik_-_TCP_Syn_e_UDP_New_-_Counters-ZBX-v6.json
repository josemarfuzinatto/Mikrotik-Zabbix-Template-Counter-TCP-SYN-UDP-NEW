{
    "zabbix_export": {
        "version": "6.0",
        "date": "2026-01-02T20:13:47Z",
        "groups": [
            {
                "uuid": "8d58b97857974b439bef7d6a27c807e5",
                "name": "Mikrotik"
            }
        ],
        "templates": [
            {
                "uuid": "de5f9bb42de94c1bba79679985954c2f",
                "template": "Mikrotik - TCP Syn e UDP New - Counters",
                "name": "Mikrotik - TCP Syn e UDP New - Counters",
                "description": "Author: Josemar Fuzinatto & GPT\n\n#substituir na macro o ID do script, possivel pegar o ID no comando:\n#comunidade SNMP tem que permitir escrita\nsnmpwalk -v2c -c <comm> <ip> 1.3.6.1.4.1.14988.1.1.8.1.1.2\n\n/ip firewall filter\nadd action=passthrough chain=forward comment=MONITOR_TCP_SYN_COUNT connection-state=new protocol=tcp tcp-flags=syn\nadd action=passthrough chain=forward comment=MONITOR_UDP_NEW_COUNT connection-state=new protocol=udp\n\nScript:\n:local output \"{\"\n:local first true\n\n# Lista exata dos comentarios\n:local listaRegras {\"MONITOR_TCP_SYN_COUNT\"; \"MONITOR_UDP_NEW_COUNT\"}\n\n:foreach nomeRegra in=$listaRegras do={\n    # Busca os IDs. Isso retorna uma lista/array.\n    :local foundIDs [/ip firewall filter find comment=$nomeRegra]\n    \n    # Verifica se a lista nao esta vazia\n    :if ([:len $foundIDs] > 0) do={\n        \n        # Pegamos apenas o primeiro ID da lista para garantir\n        :local singleID [:pick $foundIDs 0]\n        \n        # Inicializa variaveis para evitar erro\n        :local packets 0\n        :local bytes 0\n        \n        # Tenta pegar os valores\n        :do {\n            :set packets [/ip firewall filter get $singleID packets]\n            :set bytes   [/ip firewall filter get $singleID bytes]\n        } on-error={\n            :put (\"Erro ao ler dados da regra: \" . $nomeRegra)\n        }\n        \n        # Logica da virgula\n        :if ($first = false) do={ :set output ($output . \",\") }\n        :set first false\n        \n        # Monta o JSON\n        :set output ($output . \"\\\"\" . $nomeRegra . \"\\\": {\\\"packets\\\": \" . $packets . \", \\\"bytes\\\": \" . $bytes . \"}\")\n        \n    } else={\n        # Debug: Se nao achar a regra, avisa no terminal para voce saber\n        :put (\"AVISO: Nao encontrei nenhuma regra com o comentario: \" . $nomeRegra)\n    }\n}\n\n:set output ($output . \"}\")\n\n# Imprime o JSON final\n:put $output",
                "groups": [
                    {
                        "name": "Mikrotik"
                    }
                ],
                "items": [
                    {
                        "uuid": "bcf0111eb02a462ea924262bb273675a",
                        "name": "Stats TCP Syn & UDP New JSON",
                        "type": "SNMP_AGENT",
                        "snmp_oid": "1.3.6.1.4.1.14988.1.1.18.1.1.2.{$IDSCRIPT}",
                        "key": "script.json",
                        "delay": "15s",
                        "tags": [
                            {
                                "tag": "Application",
                                "value": "Firewall"
                            },
                            {
                                "tag": "Contador",
                                "value": "TCP&UDP"
                            }
                        ]
                    },
                    {
                        "uuid": "9b10e3e21a73420780f7c836c04ae9bf",
                        "name": "Counter: TCP SYN (Bytes/sec)",
                        "type": "DEPENDENT",
                        "key": "tcp_syn.bytes",
                        "delay": "0",
                        "history": "31d",
                        "value_type": "FLOAT",
                        "units": "bps",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.MONITOR_TCP_SYN_COUNT.bytes"
                                ]
                            },
                            {
                                "type": "CHANGE_PER_SECOND",
                                "parameters": [
                                    ""
                                ]
                            },
                            {
                                "type": "MULTIPLIER",
                                "parameters": [
                                    "8"
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "script.json"
                        },
                        "tags": [
                            {
                                "tag": "Counters",
                                "value": "TCP"
                            }
                        ]
                    },
                    {
                        "uuid": "dffe98ae230c441993828a51212d5d91",
                        "name": "Counter: TCP SYN (Packets/sec)",
                        "type": "DEPENDENT",
                        "key": "tcp_syn.pps",
                        "delay": "0",
                        "history": "31d",
                        "value_type": "FLOAT",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.MONITOR_TCP_SYN_COUNT.packets"
                                ]
                            },
                            {
                                "type": "CHANGE_PER_SECOND",
                                "parameters": [
                                    ""
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "script.json"
                        },
                        "tags": [
                            {
                                "tag": "Counters",
                                "value": "TCP"
                            }
                        ]
                    },
                    {
                        "uuid": "53e5c73bbbb34514a5cf5523b76c1f27",
                        "name": "Counter: UDP NEW (Bytes/sec)",
                        "type": "DEPENDENT",
                        "key": "udp_syn.bytes",
                        "delay": "0",
                        "history": "31d",
                        "value_type": "FLOAT",
                        "units": "bps",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.MONITOR_UDP_NEW_COUNT.bytes"
                                ]
                            },
                            {
                                "type": "CHANGE_PER_SECOND",
                                "parameters": [
                                    ""
                                ]
                            },
                            {
                                "type": "MULTIPLIER",
                                "parameters": [
                                    "8"
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "script.json"
                        },
                        "tags": [
                            {
                                "tag": "Counters",
                                "value": "UDP"
                            }
                        ]
                    },
                    {
                        "uuid": "a26cb5012e1e468d8bc1e102b6755d50",
                        "name": "Counter: UDP NEW (Packets/sec)",
                        "type": "DEPENDENT",
                        "key": "udp_syn.pps",
                        "delay": "0",
                        "history": "31d",
                        "value_type": "FLOAT",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.MONITOR_UDP_NEW_COUNT.packets"
                                ]
                            },
                            {
                                "type": "CHANGE_PER_SECOND",
                                "parameters": [
                                    ""
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "script.json"
                        },
                        "tags": [
                            {
                                "tag": "Counters",
                                "value": "UDP"
                            }
                        ]
                    }
                ],
                "macros": [
                    {
                        "macro": "{$IDSCRIPT}",
                        "value": "9999",
                        "description": "substituia pelo id correto encontrado com: snmpwalk -v2c -c <comm> <ip> 1.3.6.1.4.1.14988.1.1.8.1.1.2"
                    }
                ],
                "dashboards": [
                    {
                        "uuid": "abb7977a1f9f40c9a0d7207d631fb401",
                        "name": "TCP SYN & UDP NEW",
                        "pages": [
                            {
                                "widgets": [
                                    {
                                        "type": "GRAPH_CLASSIC",
                                        "name": "TCP SYN & UDP New Rate (PPS)",
                                        "width": "12",
                                        "height": "6",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter TCP SYN & UDP NEW PPS"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "type": "GRAPH_CLASSIC",
                                        "name": "TCP SYN Rate (PPS)",
                                        "y": "6",
                                        "width": "12",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter TCP SYN PPS"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "type": "GRAPH_CLASSIC",
                                        "name": "UDP New Rate (PPS)",
                                        "y": "11",
                                        "width": "12",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter UDP NEW PPS"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "type": "GRAPH_CLASSIC",
                                        "name": "TCP SYN & UDP New Rate (Bytes)",
                                        "x": "12",
                                        "width": "12",
                                        "height": "6",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter TCP SYN & UDP NEW Bytes"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "type": "GRAPH_CLASSIC",
                                        "name": "TCP SYN Rate (Bytes)",
                                        "x": "12",
                                        "y": "6",
                                        "width": "12",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter TCP SYN Bytes"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "type": "GRAPH_CLASSIC",
                                        "name": "UDP New Rate (Bytes)",
                                        "x": "12",
                                        "y": "11",
                                        "width": "12",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter UDP NEW Bytes"
                                                }
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        ],
        "graphs": [
            {
                "uuid": "2d657ed638d4438c8f113d831c2a223a",
                "name": "Counter TCP SYN & UDP NEW Bytes",
                "graph_items": [
                    {
                        "color": "1A7C11",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "tcp_syn.bytes"
                        }
                    },
                    {
                        "sortorder": "1",
                        "color": "FF0000",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "udp_syn.bytes"
                        }
                    }
                ]
            },
            {
                "uuid": "a973695bcb0442be9db89da8a5761027",
                "name": "Counter TCP SYN & UDP NEW PPS",
                "graph_items": [
                    {
                        "color": "1A7C11",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "tcp_syn.pps"
                        }
                    },
                    {
                        "sortorder": "1",
                        "color": "FF0000",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "udp_syn.pps"
                        }
                    }
                ]
            },
            {
                "uuid": "249cfedfa12f4a5889b154b1d19e259e",
                "name": "Counter TCP SYN Bytes",
                "graph_items": [
                    {
                        "color": "1A7C11",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "tcp_syn.bytes"
                        }
                    }
                ]
            },
            {
                "uuid": "3c2edfcaece041e6a14132f3c817b477",
                "name": "Counter TCP SYN PPS",
                "graph_items": [
                    {
                        "color": "1A7C11",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "tcp_syn.pps"
                        }
                    }
                ]
            },
            {
                "uuid": "68a24bfadb3d4bd4898bb3f770dce933",
                "name": "Counter UDP NEW Bytes",
                "graph_items": [
                    {
                        "color": "FF0000",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "udp_syn.bytes"
                        }
                    }
                ]
            },
            {
                "uuid": "e3712f926b074666bd9ff28970d4595f",
                "name": "Counter UDP NEW PPS",
                "graph_items": [
                    {
                        "color": "1A7C11",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "udp_syn.pps"
                        }
                    }
                ]
            }
        ]
    }
}