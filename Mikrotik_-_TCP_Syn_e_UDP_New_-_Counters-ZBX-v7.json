{
    "zabbix_export": {
        "version": "7.0",
        "template_groups": [
            {
                "uuid": "c997715833e34ece85a76685b51ce046",
                "name": "Mikrotik"
            }
        ],
        "templates": [
            {
                "uuid": "f719a2cbad4f4d3a929f50fa604a63e8",
                "template": "Mikrotik - TCP Syn e UDP New - Counters",
                "name": "Mikrotik - TCP Syn e UDP New - Counters",
                "description": "Author: Josemar Fuzinatto & GPT\n\n#substituir na macro o ID do script, possivel pegar o ID no comando:\n#comunidade SNMP tem que permitir escrita\nsnmpwalk -v2c -c <comm> <ip> 1.3.6.1.4.1.14988.1.1.8.1.1.2\n\n/ip firewall filter\nadd action=passthrough chain=forward comment=MONITOR_TCP_SYN_COUNT connection-state=new protocol=tcp tcp-flags=syn\nadd action=passthrough chain=forward comment=MONITOR_UDP_NEW_COUNT connection-state=new protocol=udp\n\nScript:\n:local output \"{\"\n:local first true\n\n# Lista exata dos comentarios\n:local listaRegras {\"MONITOR_TCP_SYN_COUNT\"; \"MONITOR_UDP_NEW_COUNT\"}\n\n:foreach nomeRegra in=$listaRegras do={\n    # Busca os IDs. Isso retorna uma lista/array.\n    :local foundIDs [/ip firewall filter find comment=$nomeRegra]\n    \n    # Verifica se a lista nao esta vazia\n    :if ([:len $foundIDs] > 0) do={\n        \n        # Pegamos apenas o primeiro ID da lista para garantir\n        :local singleID [:pick $foundIDs 0]\n        \n        # Inicializa variaveis para evitar erro\n        :local packets 0\n        :local bytes 0\n        \n        # Tenta pegar os valores\n        :do {\n            :set packets [/ip firewall filter get $singleID packets]\n            :set bytes   [/ip firewall filter get $singleID bytes]\n        } on-error={\n            :put (\"Erro ao ler dados da regra: \" . $nomeRegra)\n        }\n        \n        # Logica da virgula\n        :if ($first = false) do={ :set output ($output . \",\") }\n        :set first false\n        \n        # Monta o JSON\n        :set output ($output . \"\\\"\" . $nomeRegra . \"\\\": {\\\"packets\\\": \" . $packets . \", \\\"bytes\\\": \" . $bytes . \"}\")\n        \n    } else={\n        # Debug: Se nao achar a regra, avisa no terminal para voce saber\n        :put (\"AVISO: Nao encontrei nenhuma regra com o comentario: \" . $nomeRegra)\n    }\n}\n\n:set output ($output . \"}\")\n\n# Imprime o JSON final\n:put $output",
                "groups": [
                    {
                        "name": "Mikrotik"
                    }
                ],
                "items": [
                    {
                        "uuid": "7a065835b00144328ab225c752965cef",
                        "name": "Stats TCP Syn & UDP New JSON",
                        "type": "SNMP_AGENT",
                        "snmp_oid": "1.3.6.1.4.1.14988.1.1.18.1.1.2.{$IDSCRIPT}",
                        "key": "script.json",
                        "delay": "15s",
                        "history": "90d",
                        "value_type": "TEXT",
                        "trends": "0",
                        "tags": [
                            {
                                "tag": "Application",
                                "value": "Firewall"
                            },
                            {
                                "tag": "Contador",
                                "value": "TCP&UDP"
                            }
                        ]
                    },
                    {
                        "uuid": "34e60d548d6d401db47e5164bb5a4f6f",
                        "name": "Counter: TCP SYN (Bytes/sec)",
                        "type": "DEPENDENT",
                        "key": "tcp_syn.bytes",
                        "delay": "0",
                        "value_type": "FLOAT",
                        "units": "bps",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.MONITOR_TCP_SYN_COUNT.bytes"
                                ]
                            },
                            {
                                "type": "CHANGE_PER_SECOND",
                                "parameters": [
                                    ""
                                ]
                            },
                            {
                                "type": "MULTIPLIER",
                                "parameters": [
                                    "8"
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "script.json"
                        },
                        "tags": [
                            {
                                "tag": "Counters",
                                "value": "TCP"
                            }
                        ]
                    },
                    {
                        "uuid": "1ff710e8a4a54a5694bbc2d3cd325967",
                        "name": "Counter: TCP SYN (Packets/sec)",
                        "type": "DEPENDENT",
                        "key": "tcp_syn.pps",
                        "delay": "0",
                        "value_type": "FLOAT",
                        "units": "pps",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.MONITOR_TCP_SYN_COUNT.packets"
                                ]
                            },
                            {
                                "type": "CHANGE_PER_SECOND",
                                "parameters": [
                                    ""
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "script.json"
                        },
                        "tags": [
                            {
                                "tag": "Counters",
                                "value": "TCP"
                            }
                        ]
                    },
                    {
                        "uuid": "c778f0236e494e2aa12fbcf3de255467",
                        "name": "Counter: UDP NEW (Bytes/sec)",
                        "type": "DEPENDENT",
                        "key": "udp_syn.bytes",
                        "delay": "0",
                        "value_type": "FLOAT",
                        "units": "bps",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.MONITOR_UDP_NEW_COUNT.bytes"
                                ]
                            },
                            {
                                "type": "CHANGE_PER_SECOND",
                                "parameters": [
                                    ""
                                ]
                            },
                            {
                                "type": "MULTIPLIER",
                                "parameters": [
                                    "8"
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "script.json"
                        },
                        "tags": [
                            {
                                "tag": "Counters",
                                "value": "UDP"
                            }
                        ]
                    },
                    {
                        "uuid": "40d40f742ea54362aa7411274f21dc04",
                        "name": "Counter: UDP NEW (Packets/sec)",
                        "type": "DEPENDENT",
                        "key": "udp_syn.pps",
                        "delay": "0",
                        "value_type": "FLOAT",
                        "units": "pps",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.MONITOR_UDP_NEW_COUNT.packets"
                                ]
                            },
                            {
                                "type": "CHANGE_PER_SECOND",
                                "parameters": [
                                    ""
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "script.json"
                        },
                        "tags": [
                            {
                                "tag": "Counters",
                                "value": "UDP"
                            }
                        ]
                    }
                ],
                "macros": [
                    {
                        "macro": "{$IDSCRIPT}",
                        "value": "9999",
                        "description": "substituia pelo id correto encontrado com: snmpwalk -v2c -c <comm> <ip> 1.3.6.1.4.1.14988.1.1.8.1.1.2"
                    }
                ],
                "dashboards": [
                    {
                        "uuid": "2a0e96b93e9f42a49a63df6ca38a2106",
                        "name": "TCP SYN & UDP NEW",
                        "pages": [
                            {
                                "widgets": [
                                    {
                                        "type": "graph",
                                        "name": "TCP SYN & UDP New Rate (PPS)",
                                        "width": "36",
                                        "height": "6",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter TCP SYN & UDP NEW PPS"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "DTRYD"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "graph",
                                        "name": "TCP SYN Rate (PPS)",
                                        "y": "6",
                                        "width": "36",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter TCP SYN PPS"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "LQFWZ"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "graph",
                                        "name": "UDP New Rate (PPS)",
                                        "y": "11",
                                        "width": "36",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter UDP NEW PPS"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "JNRJV"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "graph",
                                        "name": "TCP SYN & UDP New Rate (Bytes)",
                                        "x": "36",
                                        "width": "36",
                                        "height": "6",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter TCP SYN & UDP NEW Bytes"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "HCFSX"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "graph",
                                        "name": "TCP SYN Rate (Bytes)",
                                        "x": "36",
                                        "y": "6",
                                        "width": "36",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter TCP SYN Bytes"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "JICKL"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "graph",
                                        "name": "UDP New Rate (Bytes)",
                                        "x": "36",
                                        "y": "11",
                                        "width": "36",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "GRAPH",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Mikrotik - TCP Syn e UDP New - Counters",
                                                    "name": "Counter UDP NEW Bytes"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "VFCHZ"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        ],
        "graphs": [
            {
                "uuid": "7a19e0794f334d89b6d68b9ce2d34a98",
                "name": "Counter TCP SYN & UDP NEW Bytes",
                "graph_items": [
                    {
                        "color": "1A7C11",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "tcp_syn.bytes"
                        }
                    },
                    {
                        "sortorder": "1",
                        "color": "FF0000",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "udp_syn.bytes"
                        }
                    }
                ]
            },
            {
                "uuid": "745139ab18b04aa681216f8bcd9c83f0",
                "name": "Counter TCP SYN & UDP NEW PPS",
                "graph_items": [
                    {
                        "color": "1A7C11",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "tcp_syn.pps"
                        }
                    },
                    {
                        "sortorder": "1",
                        "color": "FF0000",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "udp_syn.pps"
                        }
                    }
                ]
            },
            {
                "uuid": "668997cb9e464efaab9b0908d1697e6c",
                "name": "Counter TCP SYN Bytes",
                "graph_items": [
                    {
                        "color": "1A7C11",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "tcp_syn.bytes"
                        }
                    }
                ]
            },
            {
                "uuid": "bb4dd82f158346759b11c534333c832e",
                "name": "Counter TCP SYN PPS",
                "graph_items": [
                    {
                        "color": "1A7C11",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "tcp_syn.pps"
                        }
                    }
                ]
            },
            {
                "uuid": "a88e2c9f42d34c2d8770265ea56c7849",
                "name": "Counter UDP NEW Bytes",
                "graph_items": [
                    {
                        "color": "FF0000",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "udp_syn.bytes"
                        }
                    }
                ]
            },
            {
                "uuid": "2cd9745a6fff429f872c0820b601e8b8",
                "name": "Counter UDP NEW PPS",
                "graph_items": [
                    {
                        "color": "FF0000",
                        "calc_fnc": "ALL",
                        "item": {
                            "host": "Mikrotik - TCP Syn e UDP New - Counters",
                            "key": "udp_syn.pps"
                        }
                    }
                ]
            }
        ]
    }
}